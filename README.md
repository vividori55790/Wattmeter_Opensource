# Wattmeter_EE_3-2_TP
네, 맞습니다. 실제 하드웨어로 넘어갈 때는 코드 외에 고려할 사항이 많습니다. `Wattmeter_NanoR4_Real.ino` 코드를 기준으로, 사용자가 알아야 할 핵심 사항들을 정리해 드립니다.

### 1. 핀 결선 (Pin Connections)

코드가 올바르게 동작하기 위한 핀 연결입니다. (5조 발표자료[cite: 1563-1568]와 코드 기준)

* **MCU:** Arduino Nano R4[cite: 1530-1532, 1630-1632, 1754-1756]
* **전압 센서 (ZMPT101B):** 모듈의 `OUT` 핀 → Nano R4 `A3`
* **전류 센서 (ACS712):** 모듈의 `OUT` 핀 → Nano R4 `A4`
* **메인 릴레이 (SZH-EK082):** 모듈의 `IN` 핀 → Nano R4 `D13` (과전류 보호용)
* **PFC 릴레이 (SZH-EK082):** 모듈의 `IN` 핀 → Nano R4 `D12` (역률 개선용)
* **TFT LCD (ILI9341):** 5V 로직(Nano) ↔ 3.3V 로직(LCD)이므로, 반드시 **로직 레벨 컨버터**[cite: 1545-1547]를 중간에 사용해야 합니다.
    * `D10` (CS) → 컨버터 HV1 → 컨버터 LV1 → LCD `CS`
    * `D9` (DC) → 컨버터 HV2 → 컨버터 LV2 → LCD `DC`
    * `D8` (RST) → 컨버터 HV3 → 컨버터 LV3 → LCD `RST`
    * `D11` (MOSI) → 컨버터 HV4 → 컨버터 LV4 → LCD `SDI` (또는 MOSI)
    * `D13` (SCK) → (D13은 릴레이와 공유되므로) **D13(SCK) 핀은 LCD의 SCK로 바로 연결하고, D13에 연결된 릴레이는 다른 핀(예: D7)으로 변경하는 것을 강력히 권장합니다.**
    * *참고: ILI9341의 SDO(MISO) 핀은 읽기 기능을 사용하지 않으면 연결하지 않아도 됩니다.*



### 2. 전원 구성 및 **안전** (Power & Safety)

**가장 중요한 부분입니다. 220V AC는 매우 위험합니다.**

* **AC-DC 컨버터 (GMS1005):** 220V AC 입력을 받아 **5V DC**를 출력합니다. 이 5V DC 전원이 Arduino Nano R4의 `5V` 핀과 `GND` 핀에 연결되어 MCU, 센서, 릴레이의 동작 전원이 됩니다. [cite: 1475-1478]
* **절연:** ZMPT101B와 ACS712 모듈은 220V AC 회로와 Arduino의 5V DC 회로를 물리적으로 분리(절연)하는 핵심 부품입니다.
* **누전 차단기:** 설계도[cite: 1377-1460]에 있는 것처럼, 220V 입력단에는 반드시 누전 차단기와 퓨즈를 설치해야 합니다.

### 3. 센서 회로 상세

* **전류 센서 (ACS712):** 220V AC 라인(Live wire, 활선)을 **직렬**로 연결해야 합니다. 즉, 플러그에서 나온 220V 라인 중 한 선을 끊고, 그사이에 ACS712의 대형 스크류 터미널을 직렬로 연결합니다. (부하가 사용하는 모든 전류가 센서를 통과해야 함)
* **전압 센서 (ZMPT101B):** 220V AC 라인 두 가닥(활선, 중성선)에 **병렬**로 연결합니다. 이 모듈이 220V를 Arduino가 읽을 수 있는 저전압(0-5V)으로 낮춰줍니다.



### 4. 다음 단계: **필수 교정 (Calibration)**

하드웨어 연결 후, 코드를 그대로 사용하면 **측정값이 100% 틀립니다.** `Wattmeter_NanoR4_Real.ino` 코드 상단의 4개 상수를 반드시 수정해야 합니다.

1.  **`V_OFFSET_ADC` 및 `I_OFFSET_ADC` 교정:**
    * 모든 부하를 끈 상태(플러그는 꽂되, 멀티탭에 아무것도 연결하지 않음)로 코드를 실행합니다.
    * `SERIAL_MODE_PLOTTER`를 `1`로 설정하고 시리얼 플로터를 켭니다.
    * 전압(A3)과 전류(A4) 파형이 0을 중심으로 진동해야 합니다. 만약 파형이 위나 아래로 치우쳐 있다면, 그 치우친 값이 DC 오프셋입니다.
    * *간편법: `analogRead(A3)`와 `analogRead(A4)`의 평균값을 (부하 없이) 여러 번 측정하여, 그 값을 `V_OFFSET_ADC`와 `I_OFFSET_ADC`에 각각 입력합니다. (14비트이므로 8192 근처 값)*

2.  **`K_V_REAL` 및 `K_I_REAL` 교정 (비율 교정):**
    * 정확한 '트루 RMS 멀티미터'가 필요합니다.
    * **전압(K_V_REAL):** 멀티미터로 실제 벽 전압(예: 221.5V)을 측정합니다. 코드의 시리얼 모니터에 출력되는 `V_rms` 값(예: 215.0V)을 비교합니다.
        * `새 K_V_REAL` = `기존 K_V_REAL` * (`실제 측정값` / `코드 출력값`)
        * `새 K_V_REAL` = `0.0431` * (`221.5` / `215.0`)
    * **전류(K_I_REAL):** 전압 교정 후, 저항이 일정한 부하(예: 전기 히터)를 연결합니다. 멀티미터로 실제 전류(예: 3.5A)를 측정하고, 코드의 `I_rms` 값(예: 3.2A)과 비교하여 위와 동일한 방식으로 `K_I_REAL` 값을 보정합니다.

이 교정 작업을 거치지 않으면 '유효전력 오차 5% 이내'라는 핵심 목표[cite: 1377-1460]를 달성할 수 없습니다.

가장 먼저 D13(SCK) 핀 충돌 문제부터 해결하는 것을 추천합니다. 릴레이 핀을 D7 등으로 옮기시겠습니까?
